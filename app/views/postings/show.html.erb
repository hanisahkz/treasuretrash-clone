<script src="//maps.google.com/maps/api/js?key=<%=ENV["google_api"]%>"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->


<p id="notice"><%= notice %></p>

<div class="row">
  <div class="col-md-8 col-offset-2">
    <div class="panel panel-default">

          <% @posting.avatars.each do |x| %>
            <%= image_tag (x.medium.url) %>
          <%end%>

          <p>
            <strong>Title:</strong>
            <%= @posting.title %>
          </p>

          <p>
            <strong>Description:</strong>
            <%= @posting.description %>
          </p>

          <p>
            <strong>Condition:</strong>
            <%= @posting.condition %>
          </p>

          <p>
            <strong>Category:</strong>
            <%= @posting.category %>
          </p>

          <p>
            <strong>Location:</strong>
            <%= @posting.full_address %>
          </p>
    </div>
  </div>
</div>
<!-- <p>
  <strong>Availability:</strong>
  <%= @posting.availability %>
</p> -->

<!-- COMMENTS SECTION -->
<h2>Comments</h2>
  <% @posting.comments.each do |input| %>
    <%= input.user.email %>
    <%= time_ago_in_words(input.created_at) %><br>
    <%= input.comment %><br>
    <% if input.user_id == current_user.id %>
      <%= link_to 'Edit', edit_posting_comment_path(input.posting_id, input.id) %>
      <%= link_to 'Delete', posting_comment_path(input.posting_id, input.id), method: :delete, data: { confirm: 'Are you sure?' } %><br>
    <% end %>
  <% end %>

  <% if user_signed_in? %>
    <%= render 'comments/form' %>
<% end %>
<br>

<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers([
      {
        "lat": <%= @posting.latitude %>,
        "lng": <%= @posting.longitude %>,
        "picture": {
        "url": "http://icons.iconarchive.com/icons/paomedia/small-n-flat/32/map-marker-icon.png",
          "width":  36,
          "height": 36
        },
        "infowindow": "I'm here!"
      }
    ]);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });
</script>

<%= link_to 'Edit', edit_posting_path(@posting) %> |
<%= link_to 'Back', :back %> |
<%= form_for(@transaction, url: posting_transactions_path(@posting.id), html: {method: "post"}) do |f| %>
  <%= f.hidden_field :status, :value => true %>
  <%= f.hidden_field :success, :value => false %>
  <%= f.submit %>
<% end %>


<!-- http://www.clker.com/cliparts/c/I/g/P/d/h/google-maps-pin-blue-md.png -->

<!-- addons.cdn.mozilla.net/img/uploads/addon_icons/13/13028-64.png -->